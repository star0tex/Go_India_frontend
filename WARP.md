# WARP.md

This file provides guidance to WARP (warp.dev) when working with code in this repository.

Project overview
- This is a Flutter multi-platform app (Android, iOS, Web, Windows, macOS, Linux). Core packages include Firebase (auth/core), socket_io_client for realtime events, mapping (flutter_map/google_maps_flutter), and shared_preferences for persistence.
- Entry point: lib/main.dart initializes Firebase and establishes a singleton socket connection before bootstrapping MaterialApp (home: SplashScreen).

Common commands
- Setup
  ```powershell path=null start=null
  flutter pub get
  ```
- Run (pick one target device)
  ```powershell path=null start=null
  # Windows
  flutter run -d windows

  # Android (device/emulator must be connected)
  flutter run -d android

  # Web (Chrome)
  flutter run -d chrome
  ```
- Build
  ```powershell path=null start=null
  # Windows desktop
  flutter build windows --release

  # Android APK
  flutter build apk --release

  # Web bundle
  flutter build web --release

  # iOS/macOS builds require macOS Xcode environment
  # flutter build ios --release
  # flutter build macos --release
  ```
- Lint and format
  ```powershell path=null start=null
  # Static analysis (configured via analysis_options.yaml -> flutter_lints)
  dart analyze

  # Format and fail CI if changes are needed
  dart format --set-exit-if-changed .
  ```
- Tests
  ```powershell path=null start=null
  # Run all unit/widget tests
  flutter test

  # Run a single test file
  flutter test test/widget_test.dart

  # Run a single test by (partial) name
  flutter test -n "Counter increments smoke test"

  # Or exact match
  flutter test --plain-name "Counter increments smoke test"
  ```

High-level architecture and key modules
- Application bootstrap (lib/main.dart)
  - Ensures WidgetsFlutterBinding is initialized, initializes Firebase, connects SocketService, and starts MaterialApp.
  - Note: For web/desktop targets, Firebase typically needs explicit options. This repo includes lib/firebase_options.dart generated by FlutterFire; ensure initialization uses DefaultFirebaseOptions.currentPlatform when building for those targets.
- Realtime communication (lib/services/socket_service.dart)
  - Singleton service around socket_io_client with explicit connect(baseUrl), disconnect(), generic emit/on, and specialized domain events.
  - Persists and reuses a customer identifier via SharedPreferences. On connect/reconnect, it re-registers the customer and re-binds listeners.
  - Emits
    - customer:request_trip (typed via TripType and rideData)
  - Listens
    - trip:accepted, trip:rejected_by_system, driverLiveLocation, rideConfirmed, longTrip:standby
- Authentication (lib/services/firebase_auth_service.dart)
  - Thin wrapper over FirebaseAuth phone auth flows: sendOtp (verifyPhoneNumber) and verifyOtp (signInWithCredential), exposing simple success/error callbacks.
- Theming and persistence
  - lib/app_theme.dart defines light/dark ThemeData variants, with a warm orange-accented scheme.
  - lib/theme_provider.dart manages ThemeMode with persistence via SharedPreferences (toggleTheme, _loadTheme/_saveTheme). Wire it into the widget tree via a ChangeNotifier provider to enable dynamic theme switching.
- UI structure (selected)
  - lib/screens/... contains feature screens such as booking, live tracking, profile, history, splash, etc. The app launches at SplashScreen.
  - assets/ contains images, fonts, Lottie animations, and sounds referenced in pubspec.yaml.
- Firebase configuration
  - lib/firebase_options.dart provides platform-specific FirebaseOptions for web, android, ios, macos, and windows (linux is currently unsupported by the generated options).
  - Android includes google-services.json (android/app/google-services.json) and Gradle is Kotlin DSL.

Notes specific to this repo
- analysis_options.yaml includes flutter_lints defaults; use dart analyze to surface issues locally and in CI.
- pubspec.yaml configures flutter_launcher_icons; when you update icons, generate them with:
  ```powershell path=null start=null
  flutter pub run flutter_launcher_icons
  ```

Referenced files
- README.md contains standard Flutter getting-started links.
- No CLAUDE.md, Cursor rules, or Copilot instruction files detected.
